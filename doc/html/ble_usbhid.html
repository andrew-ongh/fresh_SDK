<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>SmartSnippets DA1468x/DA15xxx SDK: HoGP Device with USB HID dongle</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SmartSnippets DA1468x/DA15xxx SDK
   &#160;<span id="projectnumber">Version 1.0.14.1081</span>
   </div>
   <div id="projectbrief">Combo Bluetooth Smart and 802.15.4</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">HoGP Device with USB HID dongle </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview</h2>
<p>The <code>ble_usbhid_device</code> (HoGP Device) application implements a HoGP Device compliant with HoGP specification and can be used with any BLE device supporting HoGP Host (either Boot Host or Report Host), e.g. PC or a smartphone. </p><pre class="fragment">,-- DK ---------------.           ,-- PC/smartphone ----.
|                     |           |                     |
|  ble_usbhid_device  | &lt;= BLE =&gt; |    any HoGP Host    |
|                     |           |                     |
`---------------------'           `---------------------'
</pre><p>The <code>ble_usbhid_dongle</code> (USB HID Dongle) application implements parts of HoGP Report Host role which are necessary to work with HoGP Device implementation of <code>ble_usbhid_device</code>. Its purpose is to act as a bridge between HoGP Device and non-BLE HID host supporting USB HID host. It is a plug &amp; play solution which works only with specific, preconfigured HoGP Device. </p><pre class="fragment">,-- DK ---------------.           ,-- DK ---------------.           ,-- PC/smartphone ----.
|                     |           |                     |           |                     |
|  ble_usbhid_device  | &lt;= BLE =&gt; |   ble_usb_dongle    | &lt;= USB =&gt; |    non-BLE device   |
|                     |           |                     |           |                     |
`---------------------'           `---------------------'           `---------------------'
</pre><p>Once connected to HoGP Host, the HoGP Device application will act as a keyboard and mouse combo.</p>
<h2>Installation procedure</h2>
<p>HoGP Device project is located in the <b><code>projects/dk_apps/features/ble_usbhid/ble_usbhid_device</code></b> folder.</p>
<p>USB HID Dongle project is located in the <b><code>projects/dk_apps/features/ble_usbhid/ble_usbhid_dongle</code></b> folder.</p>
<p>To install both projects follow the <a class="el" href="install_and_debug_procedure.html">General Installation and Debugging Procedure</a>.</p>
<h2>PTS testing</h2>
<p>The HoGP Device application can be tested with PTS as a HID Device.</p>
<p>The USB HID Dongle application can be tested with PTS as generic BLE device.</p>
<h2>Limitations</h2>
<p>The USB HID Dongle works with only single compatible device which address is pre-programmed in dongle. This is due to following assumptions:</p>
<ol type="1">
<li>The dongle is non-interactive device thus user cannot select to which device it should connect. With pre-programmed device address the connection process is as quick as possible since there is no need to scan for compatible device prior to making connection and also there will be no conflict if there are more similar compatible devices in neighborhood.</li>
<li>The dongle does not have full HID parser thus it cannot parse and understand reports received from either device or host. It acts only as a bridge passing reports from one side to another. This means it needs to use the same report map over USB as device connected over BLE, which means the report map has to be hardcoded to match the device's report map. This is achieved by sharing report map configuration between device and dongle applications.</li>
</ol>
<h2>Manual testing</h2>
<h3>HoGP Device only</h3>
<p>After startup, device starts directed advertising to bonded host, if any, and then switches to undirected advertising. The undirected advertising is enabled for 180 seconds. To enable it again, press K2 button on DK.</p>
<p>The advertising data contains <em>HID Service</em> UUID and <em>Generic HID</em> appearance. The scan response contains <em>Dialog HoGP Device</em> name.</p>
<p>To remove bonding information from the device, reset device while holding K2 button pressed.</p>
<p>Once connected, device acts as a keyboard and mouse combo with following features:</p><ul>
<li>mouse cursor movement is simulated in a 45 degree square pattern</li>
<li>key press is simulated by sending press and release of the Num Lock key (LED state should change on other keyboards connected to the same host)</li>
<li>D2 LED is synchronized with Caps Lock state of the host (LED can be toggled by pressing Caps Lock key on other keyboards connected to the same host)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The Num Lock and Caps Lock states synchronization depends on the host. The behaviour as described above can be observed with Windows and Linux hosts, while OSX host does not seem to synchronize key states.</dd></dl>
<p>Testing procedure:</p><ol type="1">
<li>Flash <code>ble_usbhid_device</code> application as described above.</li>
<li>Reset DK</li>
<li>The device starts advertising, use compatible PC or smartphone to scan and connect to the device.</li>
<li>Due to security requirements (encryption required) the device sends <em>Security Request</em> after connection is established with the host to initiate pairing and enable encryption.</li>
<li>The device actions should be visible on the host, as described above.<ul>
<li>check that mouse cursor is moving as expected</li>
<li>check that Num Lock LED toggles every 1 second on host</li>
<li>check that Caps Lock key toggles D2 LED on DK</li>
</ul>
</li>
<li>Disconnect the device (e.g. reset DK)</li>
<li>The host should reconnect with the device and encryption should be enabled immediately withour need to pair both devices again.</li>
</ol>
<h3>USB HID Dongle with HoGP Device</h3>
<p>The procedure to setup HoGP Device is the same as in <b>HoGP Device only</b> scenario.</p>
<p>The USB HID Dongle device does not require any user interaction. Once run, it constantly scans for predefined device and automatically connects once matching device is found. If the connected device is compatible with the dongle, the security and configuration is handled automatically and the device transfers all HID traffic from/to the HoGP Device to and form the connected USB HID host.</p>
<p>The address of HoGP Device the dongle will try to connect to needs to be written to flash at address 0x80040 in following format: </p><pre class="fragment"> len | name
-----+----------------------- 
   1 | address type
     |     0x00 = public
     |     0x01 = random
   6 | device address
</pre><p>The above address can be written using <code>cli_programmer</code>, e.g. following command will setup the dongle to work with the device using a public address <code>80:EA:CA:AA:AA:AA</code>: </p><pre class="fragment">./binaries/cli_programmer gdbserver write_qspi_bytes 0x80040 0x00 0xAA 0xAA 0xAA 0xca 0xea 0x80
</pre><p>If address is not found on the flash (or address type is invalid), the default address is used.</p>
<p>Testing procedure:</p><ol type="1">
<li>Flash <code>ble_usbhid_device</code> and <code>ble_usbhid_dongle</code> applications as described above. <dl class="section warning"><dt>Warning</dt><dd>Make sure both applications are build from the same source code.</dd></dl>
</li>
<li>Setup device DK address on dongle DK as described above.</li>
<li>Connect dongle DK via USB to compatible host, it should be enumerated as HID device.</li>
<li>Reset device DK</li>
<li>The dongle DK should connect to device DK which is indicated by D2 LED on dongle DK.</li>
<li>The same behaviour should be visible on host as in <b>HoGP Device only</b> scenario.</li>
<li>Reset either of devices and the connection should be established again automatically. </li>
</ol>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 19 2018 07:50:05 for SmartSnippets DA1468x/DA15xxx SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
